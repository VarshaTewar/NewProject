<!DOCTYPE html>
<html>
<head>
    <title>Hospital Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-light bg-primary mb-4">
  <div class="container-fluid">
    <a class="navbar-brand text-white" href="/">üè• Hospital System</a>
    <div class="navbar-nav">
      <a class="nav-link text-white" href="/patients">Patients</a>
      <a class="nav-link text-white" href="/beds">Beds</a>
      <a class="nav-link text-white" href="/staff">Staff</a>
      <a class="nav-link text-white" href="/inventory">Inventory</a>
      <a class="nav-link text-white" href="/export/patients">Export Patients</a>
    </div>
    <div>
      <button id="darkToggle" class="btn btn-light me-2">Dark</button>
      <a href="/logout" class="btn btn-light">Logout</a>
    </div>
  </div>
</nav>
<div class="container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="alert alert-{{ 'danger' if category=='danger' else 'success' }}">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}
  <h2 class="text-primary">Dashboard</h2>
  <div class="row mt-4">
    <div class="col-md-3">
      <a href="/beds" class="text-decoration-none text-dark">
        <div class="card p-3 shadow">
          <h5>Total Beds</h5>
          <h2>{{ total_beds }}</h2>
        </div>
      </a>
    </div>
    <div class="col-md-3">
      <a href="/beds" class="text-decoration-none text-dark">
        <div class="card p-3 shadow">
          <h5>Occupied Beds</h5>
          <h2>{{ occupied }}</h2>
        </div>
      </a>
    </div>
    <div class="col-md-3">
      <a href="/patients" class="text-decoration-none text-dark">
        <div class="card p-3 shadow">
          <h5>Patients</h5>
          <h2>{{ patients }}</h2>
        </div>
      </a>
    </div>
    <div class="col-md-3">
      <a href="/inventory" class="text-decoration-none text-dark">
        <div class="card p-3 shadow">
          <h5>Inventory Items</h5>
          <h2>{{ total_items }}</h2>
        </div>
      </a>
    </div>
  </div>
  <div class="row mt-4">
    <div class="col-md-6">
      <div class="card p-3 shadow">
        <h5>Bed Usage</h5>
        <canvas id="bedChart" width="400" height="200"></canvas>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card p-3 shadow">
        <h5>Quick Actions</h5>
        <div class="d-flex gap-2">
          <a class="btn btn-primary" href="/patients">Manage Patients</a>
          <a class="btn btn-secondary" href="/beds">Manage Beds</a>
          <a class="btn btn-success" href="/inventory">Inventory</a>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  const bedChartData = {
    labels: ['Occupied','Available'],
    datasets: [{
      label: 'Beds',
      data: [{{ bed_chart.occupied }}, {{ bed_chart.available }}],
      backgroundColor: ['#dc3545','#198754']
    }]
  };
  const ctx = document.getElementById('bedChart').getContext('2d');
  new Chart(ctx, { type: 'doughnut', data: bedChartData });

  const toggle = document.getElementById('darkToggle');
  toggle.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    document.querySelectorAll('.card').forEach(c => c.classList.toggle('dark'));
    toggle.textContent = document.body.classList.contains('dark') ? 'Light' : 'Dark';
  });
</script>
</body>
</html>
